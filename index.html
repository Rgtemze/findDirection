<!--FIND DIRECTION-->
<!DOCTYPE html>
<html>
<head>
  <title>Find Direction</title>
  <style>
  #map {
    height: 100%;
  }
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
</style>
</head>
<body onLoad = "getLocation()">
  <script>
    var current = null;
    var previous = null;
    var map;
    var flightPath;
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(trackLocation);
        } else {
            console.log("Geolocation is not supported by this browser.");
        }
    }
    function trackLocation(pos){
      var lat = pos.coords.latitude;
      var lng = pos.coords.longitude;
      if(!current && !previous){

        current = previous = [lat,lng]
        map.setCenter({lat: current[0], lng:current[1]});

      }else{
        current = [lat,lng]
        console.log('current is ', current, 'but previous was ', previous)

        //Find the direction
        if(current[0] != previous[0] || current[1] != previous[1]){
          var res = findSlopeandRadian(current,previous)
          if(res[1] < - 65 || res[1] > 65){
            if(current[0] > previous[0]){
              console.log('NORTH')
            }else{
              console.log('SOUTH')
            }
          }else if(res[1] < -25 || res[1] > 25){
            if(current[0] > previous[0]){

              if(current[1] > previous[1]){
                console.log('NORTH EAST')
              }else{
                console.log('NORTH WEST')
              }
            }else{
              if(current[1] > previous[1]){
                console.log('SOUTH EAST')
              }else{
                console.log('SOUTH WEST')
              }
            }
          }else{

            if(current[1] > previous[1]){
              console.log('EAST')
            }else{
              console.log('WEST')
            }

          }
          console.log('slope is ', res[0], ' degree is ',res[1], 'degree')
        }
        flightPath.setPath([{lat: previous[0],lng: previous[1]},{lat: current[0] ,lng: current[1]}])
        previous = current

      }
    }
    function findSlopeandRadian(current,previous){
      var slope = (current[0] - previous[0]) / (current[1] - previous[1])
      var radian = Math.atan(slope)
      var degree = (radian)*180/Math.PI
      //if(degree < 0) degree += 180
      return [slope,degree]

    }
  </script>
  <div id="map"></div>
  <script>

    function initMap() {
     map = new google.maps.Map(document.getElementById('map'), {
        zoom: 4,
        center: {lat: 0, lng: -180},
        mapTypeId: 'terrain'
      });
      flightPath = new google.maps.Polyline({
        path: {},
        geodesic: false,
        icons: [{
                  icon: {path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW},
                  offset: '100%',
                  repeat: '20px'
              }],
        geodesic: true,
        strokeColor: '#FF0000',
        strokeOpacity: 1.0,
        strokeWeight: 2
      });

      flightPath.setMap(map);
    }
  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBM3NbeAhH1WZp727f8dfv7FMjXuG5ybAY&callback=initMap">
  </script>
</body>
</html>
